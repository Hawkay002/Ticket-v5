<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Ticketing System</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0f0f0f">

    <meta name="description" content="Secure real-time event logistics and entry management.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hawkay002.github.io/Ticket-v3/">
    <meta property="og:title" content="Event Ticketing System Command Center">
    <meta property="og:description" content="Real-time logistics, secure scanning, and remote device management.">
    
    <meta property="og:image" content="https://hawkay002.github.io/Ticket-v3/preview-banner.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://hawkay002.github.io/Ticket-v3/">
    <meta name="twitter:title" content="Event Ticketing System Command Center">
    <meta name="twitter:description" content="Real-time logistics, secure scanning, and remote device management.">
    <meta name="twitter:image" content="https://hawkay002.github.io/Ticket-v3/preview-banner.png">

    <!-- Sound effects -->
    <link rel="preload" href="success.mp3" as="audio">
    <link rel="preload" href="error.mp3" as="audio">
    <link rel="preload" href="music.mp3" as="audio">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Starry Background -->
    <div id="star-container"></div>

    <!-- 1. Login Overlay -->
    <div id="login-overlay">
        <div class="login-box">
            <h2>Command Center</h2>
            <p>Authorized Personnel Only</p>
            
            <input type="email" id="emailInput" class="premium-input" placeholder="Admin Email">
            
            <div class="password-wrapper">
                <input type="password" id="passwordInput" class="premium-input" placeholder="Password">
                <i class="fa-solid fa-eye password-toggle-icon" id="togglePassword"></i>
            </div>
            
            <button id="loginButton" class="premium-btn">Authenticate</button>
            <div id="auth-error" style="color: #ef4444; margin-top: 15px; display: none; font-size: 0.9rem;"></div>
        </div>
    </div>

    <!-- 1.1 Username Gatekeeper Modal (For Staff) -->
    <div id="username-gatekeeper-modal" class="modal-overlay" style="z-index: 2500;">
        <div class="modal-box">
            <h3>Identity Verification</h3>
            <p>Please enter your assigned username to proceed.</p>
            
            <input type="text" id="gatekeeperUsernameInput" class="premium-input" placeholder="e.g. JohnDoe" style="text-align: center; font-size: 1.2rem; margin-bottom: 20px;">
            
            <div id="gatekeeper-error" style="color: #ef4444; margin-bottom: 15px; display: none; font-size: 0.9rem;"></div>

            <button id="gatekeeperSubmitBtn" class="premium-btn success-mode" style="margin-bottom: 10px;">Verify Identity</button>
            <button id="gatekeeperLogoutBtn" class="premium-btn danger-mode">Logout</button>
        </div>
    </div>

    <!-- 2. Loading Screen -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">Establishing Secure Uplink...</div>
    </div>

    <!-- 3. Main App Content -->
    <div class="app-container" id="appContent">
        
        <header>
            <h1>EVENT LOGISTICS</h1>
            
            <div class="user-info-bar">
                <span class="sync-dot"></span>
                <span id="userEmailDisplay">Authenticating...</span>
                <button id="logoutBtn" class="logout-btn">LOGOUT</button>
            </div>

            <nav>
                <button class="nav-btn active" data-tab="create">Issue Ticket</button>
                <button class="nav-btn" data-tab="booked">Guest List</button>
                <button class="nav-btn" data-tab="scanner">Scanner</button>
                <button class="nav-btn" id="nav-logs" data-tab="logs" style="display: none;">Activity Logs</button>
                <button class="nav-btn" data-tab="settings">Config</button>
            </nav>
        </header>

        <!-- ADMIN PANEL: Device Lock Management -->
        <div id="admin-lock-panel" style="display: none; background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 16px; padding: 20px; margin-bottom: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; font-size: 1.1rem; color: var(--accent-secondary);"><i class="fa-solid fa-network-wired"></i> Remote Device Management</h3>
                
                <div style="display: flex; gap: 10px;">
                    <button id="factoryResetBtn" class="action-btn-small" style="background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <i class="fa-solid fa-skull"></i> FACTORY RESET
                    </button>
                </div>
            </div>

            <div class="managed-users-grid" id="managed-users-list">
                <!-- User cards injected by JS -->
            </div>

            <!-- Configuration Area (Hidden until user selected) -->
            <div id="user-lock-config-area" style="display: none; margin-top: 20px; border-top: 1px solid var(--border-subtle); padding-top: 20px; animation: fadeIn 0.5s;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="color: #aaa; font-size: 0.9rem;">Configuring: <strong id="selected-user-email" style="color: white;">--</strong></span>
                </div>

                <!-- Username Selection Chips -->
                 <h4 style="font-size: 0.8rem; color: #666; text-transform: uppercase; margin-bottom: 8px;">Select Usernames to Target:</h4>
                 <div id="username-list-container" class="username-list-container">
                     <!-- Username chips injected here -->
                 </div>
                 <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
                    <button id="selectAllUsernamesBtn" style="background: transparent; border: none; color: var(--accent-secondary); font-size: 0.8rem; cursor: pointer;">Select / Deselect All</button>
                 </div>

                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                    <h4 style="font-size: 0.8rem; color: #666; text-transform: uppercase; margin-bottom: 10px;">Lock Access To:</h4>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <label class="checkbox-label"><input type="checkbox" class="remote-lock-checkbox" value="create"> Issue Ticket</label>
                        <label class="checkbox-label"><input type="checkbox" class="remote-lock-checkbox" value="booked"> Guest List</label>
                        <label class="checkbox-label"><input type="checkbox" class="remote-lock-checkbox" value="scanner"> Scanner</label>
                        <label class="checkbox-label"><input type="checkbox" class="remote-lock-checkbox" value="settings"> Config</label>
                    </div>
                </div>

                <button id="triggerLockModalBtn" class="premium-btn success-mode">
                    <i class="fa-solid fa-shield-halved"></i> <span id="triggerBtnText">Sync Security Protocols</span>
                </button>
            </div>
        </div>

        <!-- USER STATUS PANEL (Visible to non-admins) -->
        <div id="user-lock-status" style="display: none; text-align: center; margin-bottom: 20px; color: #666; font-size: 0.8rem;">
            <i class="fa-solid fa-link"></i> Connected to Central Command
        </div>


        <!-- 1. Create Ticket Tab -->
        <div id="create" class="tab-content active">
            <div class="form-and-ticket">
                
                <!-- Input Form -->
                <div class="glass-panel">
                    <h2>Issue New Entry Pass</h2>
                    <form id="ticketForm">
                        <input type="text" id="name" class="premium-input" placeholder="Guest Full Name" required>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <input type="number" id="age" class="premium-input" placeholder="Age" required>
                            <select id="gender" class="premium-input" required>
                                <option value="" disabled selected>Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <span style="padding: 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-subtle); border-radius: 12px; color: #888;">ðŸ‡®ðŸ‡³ +91</span>
                            <input type="tel" id="phone" class="premium-input" placeholder="Phone Number" pattern="[0-9]{10}" required style="margin-bottom: 0;">
                        </div>

                        <button type="submit" class="premium-btn">Generate Secure Pass</button>
                    </form>
                </div>

                <!-- Live Preview Ticket -->
                <div id="ticketPreviewArea">
                    <div id="ticketTemplate">
                        <div class="ticket-content-wrapper">
                            <div class="ticket-header">
                                <h3 id="eventNamePlace">EVENT DETAILS</h3>
                                <p>OFFICIAL ENTRY PASS</p>
                            </div>
                            
                            <div class="ticket-body">
                                <div class="ticket-info">
                                    <div class="ticket-info-row">
                                        <span class="ticket-label">Guest Name</span>
                                        <div class="ticket-value" id="ticketName">--</div>
                                    </div>
                                    <div class="ticket-info-row">
                                        <span class="ticket-label">Details</span>
                                        <div class="ticket-value" id="ticketAgeGender">-- / --</div>
                                    </div>
                                    <div class="ticket-info-row">
                                        <span class="ticket-label">Contact</span>
                                        <div class="ticket-value" id="ticketPhone">--</div>
                                    </div>
                                </div>
                                <div class="ticket-qr" id="qrcode"></div>
                            </div>
                        </div>
                        <div class="ticket-footer">
                            <span id="ticketSerial">ID: --</span>
                        </div>
                    </div>
                    
                    <button id="whatsappBtn" class="premium-btn" style="margin-top: 20px; background: #25D366; color: white; border: none;" disabled>
                        <i class="fa-brands fa-whatsapp"></i> Share via WhatsApp
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. Booked Tickets Tab -->
        <div id="booked" class="tab-content">
            <div class="glass-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 15px;">
                    <h2>Guest Database <span id="refreshStatusIndicator" title="Sync Status"><i class="fa-solid fa-arrows-rotate"></i></span></h2>
                    
                    <div class="search-filter-container">
                        <div class="search-box-wrapper">
                            <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            <input type="text" id="searchGuestInput" class="search-input" placeholder="Search guests...">
                        </div>
                        
                        <div style="position: relative;">
                            <button id="filterSortBtn" class="filter-btn">
                                <i class="fa-solid fa-filter"></i> Filters
                            </button>
                            
                            <div id="filterDropdown" class="filter-dropdown">
                                <div class="dropdown-header">Sort By</div>
                                <div class="dropdown-item selected" data-type="sort" data-val="newest">Newest First</div>
                                <div class="dropdown-item" data-type="sort" data-val="oldest">Oldest First</div>
                                <div class="dropdown-item" data-type="sort" data-val="name-asc">Name (A-Z)</div>
                                
                                <div class="dropdown-divider"></div>
                                <div class="dropdown-header">Status</div>
                                <div class="dropdown-item selected" data-type="filter" data-val="all">All Statuses</div>
                                <div class="dropdown-item" data-type="filter" data-val="coming-soon">Coming Soon</div>
                                <div class="dropdown-item" data-type="filter" data-val="arrived">Arrived</div>
                                <div class="dropdown-item" data-type="filter" data-val="absent">Absent</div>

                                <div class="dropdown-divider"></div>
                                <div class="dropdown-header">Gender</div>
                                <div class="dropdown-item selected" data-type="filter-gender" data-val="all">All Genders</div>
                                <div class="dropdown-item" data-type="filter-gender" data-val="Male">Male</div>
                                <div class="dropdown-item" data-type="filter-gender" data-val="Female">Female</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Actions Toolbar -->
                <div class="select-all-container">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="selectAllCheckbox" style="transform: scale(1.2);">
                        <span style="color: #aaa; font-size: 0.9rem;">Select All Visible</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span id="selectionCount" style="color: white; font-size: 0.9rem; margin-right: 5px;">(0 selected)</span>
                        <button id="exportTriggerBtn" class="export-btn-small" disabled>
                            <i class="fa-solid fa-file-export"></i> Export
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="tickets-table" id="bookedTicketsTable">
                        <!-- Populated by JS -->
                    </table>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="selectBtn" class="premium-btn" style="width: auto; padding: 10px 20px;">Select</button>
                    <button id="deleteBtn" class="premium-btn" style="width: auto; padding: 10px 20px; background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; display: none;">Delete</button>
                </div>
            </div>
        </div>

        <!-- 3. Scanner Tab -->
        <div id="scanner" class="tab-content">
            <div class="glass-panel" style="text-align: center;">
                <h2 style="text-align: center; border-bottom: none; margin-bottom: 1rem;">Entry Scanner</h2>
                
                <div id="scanner-container">
                    <video id="scanner-video"></video>
                    <div class="scanner-overlay"></div>
                </div>

                <!-- Result Display Moved Here (Above Button) -->
                <div id="scanResult" style="display: none; margin: 20px auto; padding: 15px; border-radius: 12px; text-align: center; font-weight: 600; font-size: 1.1rem; max-width: 400px;"></div>

                <button id="startScanBtn" class="premium-btn" style="max-width: 300px; margin: 0 auto;">Activate Camera</button>
            </div>
        </div>

        <!-- 4. Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="glass-panel">
                <h2>Event Configuration</h2>
                
                <!-- Current Config Display -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border-subtle);">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <span style="display: block; color: #888; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px;">Event Name</span>
                            <span id="currentEventName" style="font-size: 1.2rem; font-weight: 500;">--</span>
                        </div>
                        <div>
                            <span style="display: block; color: #888; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px;">Location</span>
                            <span id="currentEventPlace" style="font-size: 1.2rem; font-weight: 500;">--</span>
                        </div>
                        <div style="grid-column: span 2;">
                            <span style="display: block; color: #888; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px;">Late Entry Deadline</span>
                            <span id="currentDeadline" style="font-size: 1.1rem; color: var(--accent-secondary);">--</span>
                        </div>
                    </div>
                </div>

                <form id="eventSettingsForm">
                    <h3 style="font-size: 1rem; color: #aaa; margin-bottom: 15px; text-transform: uppercase;">Update Details</h3>
                    <input type="text" id="eventName" class="premium-input" placeholder="Event Name">
                    <input type="text" id="eventPlace" class="premium-input" placeholder="Location / Venue">
                    
                    <label style="display: block; margin-bottom: 8px; color: #aaa; font-size: 0.9rem;">Late Arrival Deadline (Auto-mark Absent)</label>
                    <input type="datetime-local" id="arrivalDeadline" class="premium-input" style="color-scheme: dark;">
                    
                    <button type="submit" class="premium-btn">Save Configuration</button>
                </form>
            </div>
        </div>
        
        <!-- 5. Activity Logs Tab (Admin Only) -->
        <div id="logs" class="tab-content">
            <div class="glass-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>System Audit Logs <button id="refreshLogsBtn" style="background:none; border:none; color:#888; cursor:pointer;"><i class="fa-solid fa-arrows-rotate"></i></button></h2>
                    
                     <div class="search-filter-container">
                        <div class="search-box-wrapper">
                            <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            <input type="text" id="searchLogsInput" class="search-input" placeholder="Search logs...">
                        </div>
                        
                        <div style="position: relative;">
                            <button id="filterLogsTypeBtn" class="filter-btn">
                                <i class="fa-solid fa-filter"></i> Type
                            </button>
                            
                            <div id="filterLogsDropdown" class="filter-dropdown">
                                <div class="dropdown-header">Filter Action</div>
                                <div class="dropdown-item selected" data-type="log-filter" data-val="all">All Actions</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="LOGIN">Login / Auth</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="TICKET_CREATE">Ticket Issued</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="SCAN_ENTRY">Scan Entry</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="CONFIG_CHANGE">Config Change</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="LOCK_ACTION">Security Lock</div>
                                <div class="dropdown-item" data-type="log-filter" data-val="FACTORY_RESET">Factory Reset</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Bulk Actions -->
                <div class="logs-select-all-container">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="selectAllLogsCheckbox" style="transform: scale(1.2);">
                        <span style="color: #aaa; font-size: 0.9rem;">Select All Visible</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span id="logsSelectionCount" style="color: white; font-size: 0.9rem; margin-right: 5px;">(0 selected)</span>
                    </div>
                </div>

                <div class="table-container" style="max-height: 60vh; overflow-y: auto;">
                    <table class="tickets-table" id="activityLogsTable">
                        <!-- Logs populated by JS -->
                    </table>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="selectLogsBtn" class="premium-btn" style="width: auto; padding: 10px 20px;">Select</button>
                    <button id="deleteLogsBtn" class="premium-btn" style="width: auto; padding: 10px 20px; background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; display: none;">Delete</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <!-- Ticket View Modal -->
    <div id="ticket-view-modal" class="modal-overlay">
        <div class="modal-box" style="padding: 0; background: transparent; border: none; box-shadow: none; max-width: 340px;">
            <button class="close-modal-btn" id="closeTicketModal" style="top: -40px; right: 0;"><i class="fa-solid fa-xmark"></i></button>
            
            <div id="modalTicketTemplate">
                <div class="ticket-content-wrapper">
                    <div class="ticket-header">
                        <h3 id="modalEventNamePlace">EVENT DETAILS</h3>
                        <p>OFFICIAL ENTRY PASS</p>
                    </div>
                    
                    <div class="ticket-body">
                        <div class="ticket-info">
                            <div class="ticket-info-row">
                                <span class="ticket-label">Guest Name</span>
                                <div class="ticket-value" id="modalTicketName">--</div>
                            </div>
                            <div class="ticket-info-row">
                                <span class="ticket-label">Details</span>
                                <div class="ticket-value" id="modalTicketAgeGender">-- / --</div>
                            </div>
                            <div class="ticket-info-row">
                                <span class="ticket-label">Contact</span>
                                <div class="ticket-value" id="modalTicketPhone">--</div>
                            </div>
                        </div>
                        <div class="ticket-qr" id="modalQrcode"></div>
                    </div>
                </div>
                <div class="ticket-footer">
                    <span id="modalTicketSerial">ID: --</span>
                </div>
            </div>

            <button id="modalWhatsAppBtn" class="premium-btn" style="margin-top: 20px; background: #25D366; color: white; border: none;">
                <i class="fa-brands fa-whatsapp"></i> Share Ticket
            </button>
        </div>
    </div>

    <!-- Admin Lock Modal -->
    <div id="admin-lock-modal" class="modal-overlay">
        <div class="modal-box">
            <h3><i class="fa-solid fa-lock"></i> Security Confirmation</h3>
            <p>You are about to <span id="lock-modal-action-text" style="color: var(--accent-secondary);">modify access permissions</span> for: <br><strong id="lock-target-email" style="color: white; margin-top: 5px; display: block;">--</strong></p>
            
            <div class="password-wrapper">
                <input type="password" id="adminLockPassword" class="premium-input" placeholder="Admin Password" style="margin-bottom: 20px;">
                <i class="fa-solid fa-eye password-toggle-icon" id="toggleAdminLockPassword"></i>
            </div>
            
            <div class="modal-actions">
                <button id="cancelAdminLock" class="modal-btn secondary">Cancel</button>
                <button id="confirmAdminLock" class="modal-btn success">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Factory Reset Modal -->
    <div id="factory-reset-modal" class="modal-overlay" style="z-index: 5000;">
        <div class="modal-box" style="border-color: #ef4444;">
            <h3 style="color: #ef4444;"><i class="fa-solid fa-triangle-exclamation"></i> FACTORY RESET</h3>
            <p style="color: white;">WARNING: This will permanently delete <strong>ALL</strong> tickets, settings, and logs. This action cannot be undone.</p>
            
            <div class="password-wrapper">
                <input type="password" id="factoryResetPasswordInput" class="premium-input" placeholder="Master Password" style="margin-bottom: 20px; border-color: #ef4444;">
                <i class="fa-solid fa-eye password-toggle-icon" id="toggleFactoryPassword"></i>
            </div>
            
            <div class="modal-actions">
                <button id="cancelFactoryReset" class="modal-btn secondary">Cancel</button>
                <button id="confirmFactoryReset" class="modal-btn danger">NUKE DATABASE</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal (Tickets) -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete <span id="delete-count" style="color: white; font-weight: bold;">0</span> tickets?</p>
            <div class="modal-actions">
                <button id="cancelDelete" class="modal-btn secondary">Cancel</button>
                <button id="confirmDelete" class="modal-btn danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal (Logs) -->
    <div id="confirm-log-delete-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Delete Logs</h3>
            <p>Permanently remove <span id="delete-log-count" style="color: white; font-weight: bold;">0</span> activity records?</p>
            <div class="modal-actions">
                <button id="cancelLogDelete" class="modal-btn secondary">Cancel</button>
                <button id="confirmLogDelete" class="modal-btn danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Export Guest Data</h3>
            <p id="export-count-msg">Ready to export...</p>
            
            <input type="text" id="exportFileName" class="premium-input" placeholder="Filename (e.g. GuestList)" style="margin-bottom: 10px;">
            <select id="exportFormat" class="premium-input" style="margin-bottom: 20px;">
                <option value="csv">CSV (Excel Compatible)</option>
                <option value="xlsx">Excel Workbook (.xlsx)</option>
                <option value="pdf">PDF Document</option>
                <option value="txt">Text File</option>
                <option value="json">JSON Data</option>
                <option value="doc">Word Document</option>
            </select>
            
            <div class="modal-actions">
                <button id="cancelExport" class="modal-btn secondary">Cancel</button>
                <button id="confirmExport" class="modal-btn success">Download</button>
            </div>
        </div>
    </div>
    
    <!-- SIDE TRAY TOGGLE -->
    <div id="trayToggle" class="tray-handle">
        <i id="trayIcon" class="fa-solid fa-chevron-left"></i>
    </div>

    <!-- CONTACT TRAY -->
    <div id="contactTray" class="contact-tray">
        <h2 class="tray-heading">Emergency Contacts</h2>
        <div class="tray-content">
            <!-- 1. Event Manager -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Event Manager</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip bottom">Overall event in-charge. Contact for major issues.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Rohan Sharma</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>
            
            <!-- 2. Security Head -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Security Head</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">For crowd control and unauthorized entry.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Vikram Singh</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>

            <!-- 3. Medical Emergency -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Medical Support</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">On-site paramedic team.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Dr. Anjali</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>

            <!-- 4. Technical Support -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Technical Support</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">Wi-Fi, App, and Scanner issues.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Kabir Das</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>

            <!-- 5. Registration Desk -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Registration Desk</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">Manual check-ins and ticket reprints.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Priya Verma</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>

            <!-- 6. Venue Coordinator -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Venue Coordinator</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">Lights, AC, and facility management.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Amit Roy</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>

            <!-- 7. Catering Manager -->
            <div class="contact-section">
                <div class="section-header-wrapper">
                    <h3>Catering Manager</h3>
                    <div class="info-icon-wrapper">
                        <i class="fa-solid fa-circle-info"></i>
                        <div class="info-tooltip">For food, beverage, and dietary requirement queries.</div>
                    </div>
                </div>
                <div class="contact-card">
                    <span class="contact-name">Sneha Kapoor</span>
                    <div class="contact-actions">
                        <a href="#" class="whatsapp-btn-small"><i class="fa-brands fa-whatsapp"></i></a>
                        <a href="#" class="call-btn-small">Call <i class="fa-solid fa-phone"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Script File (Type=Module is essential for Firebase imports) -->
    <script type="module" src="script.js"></script>
</body>
</html>
